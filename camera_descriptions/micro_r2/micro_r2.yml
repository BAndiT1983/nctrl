camera_model: "micro-r2"

devices:
    sensor_io:
        channel:
            mode: "memory-map"
            base: 0x41200000
            len: 4096
        raw: "sensor_io_raw.yml"
        cooked: "sensor_io_cooked.yml"
    ar0330:
        channel:
            mode: "i2c-cdev"
            bus: 0
            address: 0x10
        raw: "ar0330_raw.yml"
        cooked: "ar0330_cooked.yml"
        computed: "ar0330_computed.yml"

globals:
  extclock: 24000000
  default_bitstream: no_patch.bit.bin
  gain: |
    function (reg_a, reg_b)
       return reg_a * reg_b
    end
  default_gain: gain(1, 2)

scripts:
  test:
    description:
    uses:
      - ar0330
      - sensor_io
    get: |
      sensor_io.raw.reset = 7
      sensor_io.raw.reset = 0
      sensor_io.raw.reset = 7
      ar0330.computed.analog_gain = 2

      return extclock .. ", " .. scripts.test2.read(devices)
    set: |
      scripts.test2.write(devices, value)

  test2:
    description:
    uses:
      - ar0330
    get: |
      return ar0330.computed.analog_gain
    set: |
      ar0330.computed.analog_gain = value
